import{Engine as D}from"https://floaty.dev/engine-v1.js";var V=()=>{return Math.round(Math.random())===1},W=(H,K)=>{let L=Math.min(H,K),U=Math.max(H,K);return L+Math.floor(Math.random()*(U-L+1))};var q=8,M=128/q,Z=45,j=25;class ${rows=128/q;updateCycle=0;roadWidth=6;roadPos=5;playerPos=Math.floor(M/2);score=0;hasCrashed=!1;init(){this.newGame()}newGame(){this.updateCycle=0,this.roadWidth=6,this.roadPos=5,this.playerPos=Math.floor(M/2),this.score=0,this.hasCrashed=!1,this.roadSections=Array(this.rows).fill().map(()=>{return new X(Array(this.rows).fill(0).map(()=>{return W(1,5)}))});for(let H=0;H<this.rows;H++)this.roadSections[H].blocks.fill(0,this.roadPos,this.roadPos+this.roadWidth)}checkCrash(){if(this.roadSections[this.rows-1].blocks[this.playerPos]!=0)this.hasCrashed=!0}manageGameSpeed(){j=Math.max(2,Math.ceil(20-this.score/Z))}adjustRoadSizeAndPosition(){if(V()){if(this.roadWidth<6)this.roadWidth+=1;else if(this.roadWidth>3)this.roadWidth-=1}if(V()){if(V()&&this.roadPos>2)this.roadPos-=1;else if(this.roadPos<M-this.roadWidth)this.roadPos+=1}}update(){if(this.updateCycle+=1,this.updateCycle>=j){if(this.updateCycle=0,this.manageGameSpeed(),this.checkCrash(),!this.hasCrashed){this.score+=1;let H=[];H.push(new X(Array(this.rows).fill(0).map(()=>{return W(1,5)}))),this.adjustRoadSizeAndPosition(),H[0].blocks.fill(0,this.roadPos,this.roadPos+this.roadWidth);for(let K=0;K<this.rows-1;K++)H.push(this.roadSections[K]);this.roadSections=H}this.checkCrash()}}draw(){for(let L=0;L<M;L++)for(let U=0;U<M;U++){let F=U*q,G=L*q;switch(this.roadSections[L].blocks[U]){case 0:rectFill(F,G,F+q,G+q,0);break;case 1:rectFill(F,G,F+q,G+q,3);break;case 2:rectFill(F,G,F+q,G+q,3),pset(F+5,G+5,11),pset(F+4,G+4,11),pset(F+6,G+4,11);break;case 3:rectFill(F,G,F+q,G+q,3),pset(F+5,G+2,14);break;case 4:rectFill(F,G,F+q,G+q,3),pset(F+5,G+6,11);break;case 5:rectFill(F,G,F+q,G+q,3);break;default:rectFill(F,G,F+q,G+q,1)}}let H=this.playerPos*q,K=(this.rows-1)*q;if(this.hasCrashed)rectFill(H,K,H+q,K+q,8);else rectFill(H,K,H+q,K+q,7);if(text(`Score: ${this.score}`,1,1,15),this.hasCrashed)rectFill(30,55,100,76,7),text("CRASHED!",46,55,8),text("(R)estart?",46,65,8)}}class X{constructor(H){this.blocks=H}}var C=new D;C.expose();var Y={},A={},J=new $,Q=!1;async function B(){J.init(),await this.load()}function I(){if(!Q){if(J.update(),!J.hasCrashed){if(btnp("a")||btnp("ArrowLeft")){if(J.playerPos>0)J.playerPos-=1,J.checkCrash()}if(btnp("d")||btnp("ArrowRight")){if(J.playerPos<M-1)J.playerPos+=1,J.checkCrash()}if(btnp("w")||btnp("ArrowUp"))J.score+=Z}}}function f(){if(Q)rectFill(30,55,100,65,1),text("PAUSED",50,55,9);else cls(),J.draw();if(btnp("p"))Q=!Q;if(Q){if(btnp("a")||btnp("d")||btnp("ArrowLeft")||btnp("ArrowRight"))Q=!1}if(J.hasCrashed){if(btnp("r"))Q=!1,J.newGame()}}C.start({sprites:Y,sounds:A,init:B,update:I,draw:f,target:document.querySelector(".thecar")});
