import{Engine as j}from"https://floaty.dev/engine-v1.js";var W=()=>{return Math.random()>0.5},X=(F,K)=>{return F+Math.floor(Math.random()*(K-F+1))};var q=8,L=128/q,Q=20;class ${rows=128/q;updateCycle=0;roadWidth=6;roadPos=5;playerPos=Math.floor(L/2);score=0;hasCrashed=!1;init(){this.newGame()}newGame(){this.updateCycle=0,this.roadWidth=6,this.roadPos=5,this.playerPos=Math.floor(L/2),this.score=0,this.hasCrashed=!1,this.roadSections=Array(this.rows).fill().map(()=>{return new Z(Array(this.rows).fill(0).map(()=>{return X(1,5)}))});for(let F=0;F<this.rows;F++)this.roadSections[F].blocks.fill(0,this.roadPos,this.roadPos+this.roadWidth)}checkCrash(){if(this.roadSections[this.rows-1].blocks[this.playerPos]!=0)this.hasCrashed=!0}update(){if(this.updateCycle+=1,this.updateCycle>=Q){if(this.updateCycle=0,this.score>50)Q=15;if(this.score>150)Q=12;if(this.score>350)Q=9;if(this.score>500)Q=4;if(this.checkCrash(),!this.hasCrashed){this.score+=1;let F=[];if(F.push(new Z(Array(this.rows).fill(0).map(()=>{return X(1,5)}))),W()){if(this.roadWidth<6)this.roadWidth+=1;else if(this.roadWidth>3)this.roadWidth-=1}if(W()){if(W()&&this.roadPos>2)this.roadPos-=1;else if(this.roadPos<L-this.roadWidth)this.roadPos+=1}F[0].blocks.fill(0,this.roadPos,this.roadPos+this.roadWidth);for(let K=0;K<this.rows-1;K++)F.push(this.roadSections[K]);this.roadSections=F}this.checkCrash()}}draw(){for(let U=0;U<L;U++)for(let V=0;V<L;V++){let G=V*q,H=U*q;switch(this.roadSections[U].blocks[V]){case 0:rectFill(G,H,G+q,H+q,0);break;case 1:rectFill(G,H,G+q,H+q,3);break;case 2:rectFill(G,H,G+q,H+q,3);break;case 3:rectFill(G,H,G+q,H+q,3),pset(G+7,H+2,14);break;case 4:rectFill(G,H,G+q,H+q,3),pset(G+7,H+7,11);break;case 5:rectFill(G,H,G+q,H+q,3);break;default:rectFill(G,H,G+q,H+q,1)}}let F=this.playerPos*q,K=(this.rows-1)*q;if(this.hasCrashed)rectFill(F,K,F+q,K+q,8);else rectFill(F,K,F+q,K+q,7);if(text(`Score: ${this.score}`,1,1,15),this.hasCrashed)rectFill(30,55,100,76,7),text("CRASHED!",46,55,8),text("(R)estart?",46,65,8)}}class Z{constructor(F){this.blocks=F}}var f=new j;f.expose();var C={},D={},J=new $,M=!1;async function Y(){J.init(),await this.load()}function A(){if(!M){if(J.update(),!J.hasCrashed){if(btnp("a")||btnp("ArrowLeft")){if(J.playerPos>0)J.playerPos-=1,J.checkCrash()}if(btnp("d")||btnp("ArrowRight")){if(J.playerPos<L-1)J.playerPos+=1,J.checkCrash()}}}}function B(){if(M)rectFill(30,55,100,65,1),text("PAUSED",50,55,9);else cls(),J.draw();if(btnp("p"))M=!M;if(M){if(btnp("a")||btnp("d")||btnp("ArrowLeft")||btnp("ArrowRight"))M=!1}if(J.hasCrashed){if(btnp("r"))M=!1,J.newGame()}}f.start({sprites:C,sounds:D,init:Y,update:A,draw:B,target:document.querySelector(".thecar")});
