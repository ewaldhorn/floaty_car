import{Engine as D}from"https://floaty.dev/engine-v1.js";var V=()=>{return Math.random()>0.5},W=(F,K)=>{return F+Math.floor(Math.random()*(K-F+1))};var q=8,L=128/q,Z=45,j=25;class ${rows=128/q;updateCycle=0;roadWidth=6;roadPos=5;playerPos=Math.floor(L/2);score=0;hasCrashed=!1;init(){this.newGame()}newGame(){this.updateCycle=0,this.roadWidth=6,this.roadPos=5,this.playerPos=Math.floor(L/2),this.score=0,this.hasCrashed=!1,this.roadSections=Array(this.rows).fill().map(()=>{return new X(Array(this.rows).fill(0).map(()=>{return W(1,5)}))});for(let F=0;F<this.rows;F++)this.roadSections[F].blocks.fill(0,this.roadPos,this.roadPos+this.roadWidth)}checkCrash(){if(this.roadSections[this.rows-1].blocks[this.playerPos]!=0)this.hasCrashed=!0}manageGameSpeed(){j=Math.max(2,Math.ceil(20-this.score/Z))}adjustRoadSizeAndPosition(){if(V()){if(this.roadWidth<6)this.roadWidth+=1;else if(this.roadWidth>3)this.roadWidth-=1}if(V()){if(V()&&this.roadPos>2)this.roadPos-=1;else if(this.roadPos<L-this.roadWidth)this.roadPos+=1}}update(){if(this.updateCycle+=1,this.updateCycle>=j){if(this.updateCycle=0,this.manageGameSpeed(),this.checkCrash(),!this.hasCrashed){this.score+=1;let F=[];F.push(new X(Array(this.rows).fill(0).map(()=>{return W(1,5)}))),this.adjustRoadSizeAndPosition(),F[0].blocks.fill(0,this.roadPos,this.roadPos+this.roadWidth);for(let K=0;K<this.rows-1;K++)F.push(this.roadSections[K]);this.roadSections=F}this.checkCrash()}}draw(){for(let Q=0;Q<L;Q++)for(let U=0;U<L;U++){let G=U*q,H=Q*q;switch(this.roadSections[Q].blocks[U]){case 0:rectFill(G,H,G+q,H+q,0);break;case 1:rectFill(G,H,G+q,H+q,3);break;case 2:rectFill(G,H,G+q,H+q,3);break;case 3:rectFill(G,H,G+q,H+q,3),pset(G+5,H+2,14);break;case 4:rectFill(G,H,G+q,H+q,3),pset(G+5,H+6,11);break;case 5:rectFill(G,H,G+q,H+q,3);break;default:rectFill(G,H,G+q,H+q,1)}}let F=this.playerPos*q,K=(this.rows-1)*q;if(this.hasCrashed)rectFill(F,K,F+q,K+q,8);else rectFill(F,K,F+q,K+q,7);if(text(`Score: ${this.score}`,1,1,15),this.hasCrashed)rectFill(30,55,100,76,7),text("CRASHED!",46,55,8),text("(R)estart?",46,65,8)}}class X{constructor(F){this.blocks=F}}var C=new D;C.expose();var Y={},A={},J=new $,M=!1;async function B(){J.init(),await this.load()}function I(){if(!M){if(J.update(),!J.hasCrashed){if(btnp("a")||btnp("ArrowLeft")){if(J.playerPos>0)J.playerPos-=1,J.checkCrash()}if(btnp("d")||btnp("ArrowRight")){if(J.playerPos<L-1)J.playerPos+=1,J.checkCrash()}if(btnp("w")||btnp("ArrowUp"))J.score+=Z}}}function f(){if(M)rectFill(30,55,100,65,1),text("PAUSED",50,55,9);else cls(),J.draw();if(btnp("p"))M=!M;if(M){if(btnp("a")||btnp("d")||btnp("ArrowLeft")||btnp("ArrowRight"))M=!1}if(J.hasCrashed){if(btnp("r"))M=!1,J.newGame()}}C.start({sprites:Y,sounds:A,init:B,update:I,draw:f,target:document.querySelector(".thecar")});
